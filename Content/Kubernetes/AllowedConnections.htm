<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1>Cluster Policy</h1>
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/UL_Contents.flsnp" />
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/H2_Overview.flsnp" />
        <MadCap:snippetBlock src="WhatIsClusterPolicy.flsnp" />
        <p MadCap:conditions="General.Exclude">
            <MadCap:concept term="Kubernetes" />[REMOVED BECAUSE WE DON'T EXPORT EGRESS POLICIES] IP addresses cannot be specified manually but those identified from the discovered connections are remembered by <MadCap:variable name="local-orca.Product_S" /> and later used to create Kubernetes network policies.</p>
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/H3_SeeHere.flsnp" />
        <p>
            <img src="../Kubernetes-Images/Screen_AllowedConnections.png" class="ThumbnailPopup" />
        </p>
        <ul>
            <li><span class="SpecialBold">Source</span>: The location from which the connection will be made. Can be Ingress, Any or namespace. If namespace, it may include Kubernetes service, container and process</li>
            <li><span class="SpecialBold">Destination</span>: The location to which the connection will be made. Can be:&#160;External service, domain or namespace. If namespace, it may include Kubernetes service, container and process</li>
            <li><span class="SpecialBold">Port</span>: The port to which the connection will be addressed</li>
            <li><span class="SpecialBold">Last Hit</span>:&#160;The last time a matching connection was made</li>
            <li><span class="SpecialBold">Description</span>:&#160;Optional for manually added rules</li>
        </ul>
        <p>Until you add new rules, the list contains only these allowed connections:</p>
        <ul>
            <li>
                <p>From source service <MadCap:variable name="local-orca.Kite" />  to destination tufin.io</p>
            </li>
            <li>
                <p>From source all namespaces to destination Kubernetes DNS</p>
            </li>
        </ul>
        <p>The <MadCap:variable name="local-orca.Kite" /> rule should not be deleted or changed. However, if deleted it can be recreated manually or selected from the <a href="NewConnections.htm">New Connections screen</a>. New allowed connections are added by selecting them from the new connections discovered or defined manually. </p>
        <p>Your policy will always be in one of two Policy Modes - <span class="StatusOrValue">Learn</span> or <span class="StatusOrValue">Enforce</span> . When in <span class="StatusOrValue">Learn</span> mode, <MadCap:variable name="local-orca.Product_S" /> will not apply any limitations on traffic in the cluster. When in <span class="StatusOrValue">Enforce</span> mode, <MadCap:variable name="local-orca.Product_S" /> will apply limitations on the traffic. Switching modes is done in <a href="OrcaSettingsGeneral.htm">Settings</a>. </p>
        <p class="h3">Why Manage Policy in <MadCap:variable name="local-orca.Product_S" />?</p>
        <ol>
            <li>To have a clear and documented set of security rules for your cluster that you can review and present whenever needed.</li>
            <li>To apply your security rules to your cluster as Kubernetes network policies.</li>
            <li>To know about connections made that you haven't accounted for; you can get instant alerts too.</li>
        </ol>
        <p>Adding rules can also be done  in <a href="NewConnections.htm">New Connections</a>.</p>
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/H2_Actions.flsnp" />
        <ul class="Action">
            <li><a href="#Adding_an_Allowed_Connection_Manually">Add a rule</a>
            </li>
            <li><a href="#Deleting">Delete rules</a>
            </li>
            <li><a href="#Export">Export as Kubernetes network policies</a>
            </li>
            <li><a href="#ApplyOnFW">Apply on firewalls</a>
            </li>
        </ul>
        <p><a name="Adding_an_Allowed_Connection_Manually"></a>
        </p>
        <p class="h3">Add a Rule</p>
        <p>To specify an allowed connection from a namespace in your cluster to a domain outside of the cluster. </p>
        <ol>
            <li>
                <p>Click on <span class="ScreenObject">Add Rule</span>. The <span class="ScreenObject">Add Rule</span> window is displayed. </p>
                <p>
                    <img src="../Kubernetes-Images/WindowAddAllowedConnection.png" class="ThumbnailPopup" />
                </p>
            </li>
            <li>
                <p>Enter the details:</p>
                <ul>
                    <li>
                        <p>Source - Select a namespace from the list, or select All</p>
                    </li>
                    <li>
                        <p>Destination - Enter a valid domain name (DNS). Optionally use the wildcard character on the left of the name to include multiple protocols and/or sub-domains</p>
                        <p>Examples:&#160;api.example.io, *.example.com</p>
                    </li>
                    <li>Description - optional</li>
                </ul>
            </li>
            <li>Click <span class="ScreenObject">Add Rule</span> . The rule will be added to the list</li>
        </ol>
        <p class="h3"><a name="Deleting"></a>Delete Rules</p>
        <p>Rules can be deleted from the security policy one at a time:</p>
        <ol>
            <li>Hover over the line for the appropriate rule and click <img src="../Kubernetes-Images/IconRemove.png" class="noborder" /> when it appears.</li>
        </ol>
        <p>All rules can be deleted in a single action:</p>
        <ol>
            <li>Click on <img src="../SecureCloud-Images/Icon_3dots.png" class="noborder" />- the action menu is displayed</li>
            <li>Select <span class="ScreenObject">Remove all rules</span> </li>
        </ol>
        <p class="h3"><a name="Locking"></a><a name="Resettin"></a><a name="Export"></a>Export as Kubernetes Network Policies</p>
        <p class="normal">The security policy will be exported for the namespaces specified in the current namespace filter. A file named &lt;<MadCap:variable name="local.domain" />&gt;-&lt;<MadCap:variable name="local.project" />&gt;.yml will be downloaded via the browser. See <MadCap:xref href="Enforcement.htm">[%=local.Kubernetes%] Policy Enforcement</MadCap:xref>.</p>
        <ol>
            <li>
                <p>Click on <img src="../SecureCloud-Images/Icon_3dots.png" class="noborder" />- the action menu is displayed.</p>
            </li>
            <li>
                <p>Select <span class="ScreenObject">Export as network policies </span>from the menu. </p>
            </li>
            <li>
                <p>Apply the policies by running kubectl apply -f &lt;yaml file name&gt;. For more information on kubectl, see the Kubernetes documentation. </p>
            </li>
        </ol>
        <div class="Warning">
             This mechanism uses the namespace selector in combination with podSelector. Therefore, for the export action to work:
            <ol><li>You must be on Kubernetes 1.11 or higher</li><li>You must assign an explicit name label to your cluster namespace in the format: "namespace : &lt; namespace name &gt;"</li></ol></div>
        <p class="h3"><a name="ApplyOnFW"></a>Apply on Firewalls</p>
        <p>Apply on firewalls applies your <MadCap:variable name="local-orca.Product_S" /> security policy to any firewalls you have integrated previously with <MadCap:variable name="local-orca.Product_S" /> (see <a href="Firewalls.htm">Firewalls</a>). Currently, <MadCap:variable name="local-orca.SC" /> and Microsoft Azure are the only supported applications and Microsoft Azure only works for egress rules. </p>
        <p>After the apply on firewalls process is initiated, the tickets created can be seen on the <a href="FirewallTickets.htm">Firewall Tickets Screen</a>, together with their status. </p>
        <ol>
            <li>
                <p>Click on <img src="../SecureCloud-Images/Icon_3dots.png" class="noborder" />- the action menu is displayed.</p>
                <p><MadCap:variable name="local-orca.Product_S" /> recognizes whether the integration is set up. If there is no integration, the <span class="MenuItem">Apply on Firewalls</span> option in the menu will be greyed out and unclickable, and it will show as <span class="MenuItem">Apply on Firewalls (Disabled)</span>. </p>
            </li>
            <li>
                <p>Select <span class="ScreenObject">Apply on Firewalls</span> from the menu. This will initiate the process and change the option in the <span class="ScreenObject">Actions Menu</span> to be greyed out and show as <span class="MenuItem">Apply on Firewalls (in-progress)</span>. This status will remain until all requests (tickets) have been resolved and implemented or deleted in the network policy change management system. You cannot initiate the process again while there are requests still in progress.  A separate request (ticket) will be submitted for each namespace in your current filter (see <a href="../SecureCloud/Navigation.htm#Filter">Filter by Namespace</a>). Requests that have been submitted cannot be deleted within <MadCap:variable name="local-orca.Product_S" />. </p>
            </li>
        </ol>
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/H2_GetHere.flsnp" />
        <MadCap:snippetBlock src="../Resources/Snippets/GetHere_AllowedConnections.flsnp" />
    </body>
</html>