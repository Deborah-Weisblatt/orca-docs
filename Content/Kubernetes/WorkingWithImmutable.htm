<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1><a name="top"></a>Implement an Immutable Policy</h1>
        <ul>
            <li><a href="#overview">Overview</a>
            </li>
            <li><a href="#Implemen">Implementation</a>
            </li>
        </ul>
        <p class="h2"><a name="overview"></a>Overview</p>
        <p>An approach to security in which you never modify an existing policy but rather replace it with a new one. See <a href="ImmutablePolicy.htm">Immutable Policy Concepts.</a></p>
        <p class="h2"><a name="Implemen"></a>Implementation</p>
        <p class="h3">Development and QA Phase</p>
        <ul>
            <li>Develop and commit code as usual.</li>
            <li>Write tests to run all the functionally in your application, if not already done as part of your QA process. The significance of 'all functionality' is to initiate connections between every source and destination pod in the app that will be required at some stage of running the application. These connections will be used by <MadCap:variable name="local-orca.Product_S" />to create the list of allowed connections in the security policy. </li>
        </ul>
        <p class="h3">Build Phase</p>
        <p>You can run these steps manually or build them into your CI/CD Pipeline. </p>
        <p class="h4">Parameters Used in the scripts below</p>
        <p>${<b>APIKey</b>}:&#160;As created in <a href="../SecureCloud/APIAccessKeys.htm">API access key</a></p>
        <p>${<MadCap:variable name="local.SecurecloudAccount" style="font-weight: bold;" />}: Your <MadCap:variable name="local-orca.Product_S" /> <MadCap:variable name="local.Securecloudaccount" /> name</p>
        <p>${<MadCap:variable name="local.Project" style="font-weight: bold;" />} Your monitored <MadCap:variable name="local.project" /> name</p>
        <ol>
            <li>
                <p>Check out your code.</p>
            </li>
            <li>
                <p>Build your code.</p>
            </li>
            <li>
                <p>Reset your policy.</p><pre xml:space="preserve">"bash &lt;(curl -s -H "Authorization: Bearer ${<b>APIKey</b>}" "https://${<MadCap:variable name="local.SecurecloudAccount" style="font-weight: bold;" />}.securecloud.tufin.io/api/orca/model/clusters/${<MadCap:variable name="local.Project" style="font-weight: bold;" />}/scripts/reset-policy")"</pre>
            </li>
            <li>
                <p>Run tests: unit, integration, system...</p>
            </li>
            <li>
                <p>Generate <MadCap:variable name="local-orca.Product_S" /> cluster policy,  based on automatic connectivity found by <MadCap:variable name="local-orca.Product_S" />.</p><pre xml:space="preserve">"bash &lt;(curl -s -H "Authorization: Bearer ${<b>APIKEY</b>}" "https://${<MadCap:variable name="local.SecurecloudAccount" style="font-weight: bold;" />}.securecloud.tufin.io/api/orca/model/clusters/${<MadCap:variable name="local.Project" style="font-weight: bold;" />}/scripts/commit-policy")"</pre>
            </li>
            <li>
                <p>Create network policy YAML from <MadCap:variable name="local-orca.Product_S" /> cluster policy.</p><pre xml:space="preserve">curl -s -H "Authorization: Bearer ${<b>APIKEY</b>}" "https://${<MadCap:variable name="local.SecurecloudAccount" style="font-weight: bold;" />}.securecloud.tufin.io/api/orca/model/clusters/${<MadCap:variable name="local.Project" style="font-weight: bold;" />}/rules-network-policies.yaml?namespaces=__all__" --output &lt;local-filename&gt;</pre>
            </li>
            <li>
                <p>Commit the network policy to your pipeline, using GitHub or other appropriate tool. </p>
            </li>
        </ol>
    </body>
</html>