<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../Resources/TableStyles/PatternedRows.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <h1>Security Policy -  Allowed Connections</h1>
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/UL_Contents.flsnp" />
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/H2_Overview.flsnp" />
        <MadCap:snippetBlock src="WhatIsClusterPolicy.flsnp" />
        <p>IP addresses cannot be specified manually but those identified from the discovered connections are remembered by <MadCap:variable name="local-orca.Product_S" /> and later used to create Kubernetes network policies.</p>
        <p>
            <img src="../_Orca-Images/ScreenPolicyAllowedConnections.png" class="ThumbnailPopup" />
        </p>
        <p>Initially the list contains two allowed connections:</p>
        <ul>
            <li>
                <p>From the <MadCap:variable name="local-orca.Kite" /> (Kite) to tufin.io</p>
            </li>
            <li>
                <p>From all namespaces to the Kubernetes DNS</p>
            </li>
        </ul>
        <p>The <MadCap:variable name="local-orca.Kite" /> rule should not be deleted or changed. However, if deleted it can be recreated manually or selected from the <a href="Discovery.htm">New Connections Window</a>. New allowed connections are added by selecting them from the new connections discovered or defined manually. </p>
        <p>Your policy will always be in one of two Policy Modes - <span class="StatusOrValue">Learn</span> or <span class="StatusOrValue">Enforce</span> . When in <span class="StatusOrValue">Learn</span> mode, <MadCap:variable name="local-orca.Product_S" /> will not apply any limitations on traffic in the cluster. When in <span class="StatusOrValue">Enforce</span> mode, <MadCap:variable name="local-orca.Product_S" /> will apply limitations on the traffic. Switching modes is done in <a href="OrcaSettingsGeneral.htm">Settings</a>. </p>
        <p class="h3">Why Manage Policy in <MadCap:variable name="local-orca.Product_S" />?</p>
        <ol>
            <li>To have a clear and documented set of security rules for your cluster that you can review and present whenever needed.</li>
            <li>To apply your security rules to your cluster as Kubernetes network policies.</li>
            <li>To know about connections made that you haven't accounted for; you can get instant alerts too.</li>
        </ol>
        <p>Adding allowed connections can also be done  from the <a href="Discovery.htm">New Connections Window</a>.</p>
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/H2_Actions.flsnp" />
        <ul class="Action">
            <li><a href="#Adding_an_Allowed_Connection_Manually">Add an allowed connection</a>
            </li>
            <li><a href="#Deleting">Delete an allowed connection</a>
            </li>
            <li><a href="#Locking">Lock / unlock an allowed connection</a>
            </li>
            <li><a href="#Resettin">Reset allowed connections</a>
            </li>
            <li><a href="#Export">Export as Kubernetes network policies</a>
            </li>
            <li><a href="#ApplyOnFW">Apply on firewalls</a>
            </li>
        </ul>
        <p><a name="Adding_an_Allowed_Connection_Manually"></a>
        </p>
        <p class="h3">Add an Allowed Connection</p>
        <p>To specify an allowed connection from a namespace in your cluster to a domain outside of the cluster. </p>
        <ol>
            <li>
                <p>Click on the <span class="ScreenObject">Add</span> icon (<img src="../_Orca-Images/IconAddEnforce.png" class="noborder" /> or <img src="../_Orca-Images/IconAddLearning.png" class="noborder" /> depending on the currently selected policy mode). The <span class="ScreenObject">Add Allowed Connection</span> window is displayed. </p>
                <p>
                    <img src="../_Orca-Images/WindowAddAllowedConnection.png" class="ThumbnailPopup" />
                </p>
            </li>
            <li>
                <p>Enter the details:</p>
                <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/PatternedRows.css');" class="TableStyle-PatternedRows" cellspacing="0">
                    <caption>Fields on the Screen</caption>
                    <col class="TableStyle-PatternedRows-Column-Regular" style="width: 477px;" />
                    <col class="TableStyle-PatternedRows-Column-Regular" />
                    <thead>
                        <tr class="TableStyle-PatternedRows-Head-Header1">
                            <th class="TableStyle-PatternedRows-HeadE-Regular-Header1">
                                <p class="TableHeading">Field Name</p>
                            </th>
                            <th class="TableStyle-PatternedRows-HeadD-Regular-Header1">
                                <p class="TableHeading">Value</p>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="TableStyle-PatternedRows-Body-LightRows">
                            <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">From</td>
                            <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">Click in the field to display the list of available namespaces and then click on the required value</td>
                        </tr>
                        <tr class="TableStyle-PatternedRows-Body-DarkRows">
                            <td class="TableStyle-PatternedRows-BodyB-Regular-DarkRows">To </td>
                            <td class="TableStyle-PatternedRows-BodyA-Regular-DarkRows">
                                <p>Type a valid domain name (DNS). Optionally use the wildcard character on the left of the name. This will allow multiple protocols and/or sub-domains to be included in the same rule.</p>
                                <p>Examples:&#160;api.example.io, *.example.com</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </li>
            <li>Click <span class="ScreenObject">Add Rule</span> . The rule will be added to the list.</li>
        </ol>

        <p class="h3"><a name="Deleting"></a>Delete an Allowed Connection</p>
        <p>Rules can be deleted from the security policy at any time. </p>
        <ol>
            <li>Hover over the line for the appropriate rule and click <img src="../_Orca-Images/IconRemove.png" class="noborder" /> when it appears on the line.</li>
            <li>The allowed connection will be removed.</li>
        </ol>
        <p class="h3"><a name="Locking"></a>Lock / Unlock an Allowed Connection</p>
        <p>The purpose of locking rules is to prevent them from being deleted when resetting allowed connections. However, a locked rule can individually be deleted in the same way as an unlocked rule. Rules can be locked and unlocked in the security policy at any time. </p>
        <p>To lock a rule:</p>
        <ol>
            <li>Hover over the line for the appropriate rule and click the <span class="ScreenObject">Lock icon <img src="../_Orca-Images/IconUnlock.png" class="noborder"></img></span> when it appears on the line.</li>
            <li>Thereafter, the rule will display the <span class="ScreenObject">Locked icon</span> <img src="../_Orca-Images/IconLocked.png" class="noborder" /> all the time.</li>
        </ol>
        <p>To unlock a rule:</p>
        <ol>
            <li>Click the <span class="ScreenObject">Locked icon</span> <img src="../_Orca-Images/IconLocked.png" class="noborder" /> on the desired line.</li>
            <li>The <span class="ScreenObject">Locked icon</span> will be removed from the line.</li>
        </ol>
        <p class="h3"><a name="Resettin"></a>Reset Allowed Connections</p>
        <p>Resetting allowed connections restores your policy to a base-line of allowed rules. All rules that have been locked constitute your base-line and if no rules have been locked, your base-line is a policy with no rules whatsoever.</p>
        <ol>
            <li>
                <p>Click on <span class="ScreenObject">Actions</span>  to display the <span class="ScreenObject">Actions</span> menu.</p>
                <p>
                    <img src="../_Orca-Images/MenuSecurityPolicyActions.png" />
                </p>
            </li>
            <li>
                <p>Click on <span class="ScreenObject">Reset Allowed Connections</span> from the menu.</p>
            </li>
            <li>
                <p>All allowed connections will be deleted from the security policy, except those that are <a href="#Locking">locked</a>.</p>
            </li>
        </ol>
        <p class="h3"><a name="Export"></a>Export as Kubernetes Network Policies</p>
        <p class="normal">The security policy will be exported for all namespaces - any screen filtering on namespace is ignored. A file named &lt;domain&gt;-&lt;project&gt;.yml will be downloaded via the browser. See Enforcement to learn how <MadCap:variable name="local-orca.Product_S" /> </p>
        <ol>
            <li>
                <p>Click on <span class="ScreenObject">Actions</span>  to display the <span class="ScreenObject">Actions</span> menu.</p>
                <p>
                    <img src="../_Orca-Images/MenuSecurityPolicyActions.png" />
                </p>
            </li>
            <li>
                <p>Click on <span class="ScreenObject">Export as network policies </span>from the menu. </p>
            </li>
            <li>
                <p>Apply the policies by running kubectl apply -f &lt;yaml file name&gt;. For more information on kubectl, see the Kubernetes documentation. </p>
            </li>
        </ol>
        <div class="Warning">
             This mechanism uses the namespace selector in combination with podSelector. Therefore, for the export action to work:
            <ol><li>You must be on Kubernetes 1.11 or higher</li><li>You must assign an explicit name label to your cluster namespace in the format: "namespace : &lt; namespace name &gt;"</li></ol></div>
        <p class="h3"><a name="ApplyOnFW"></a>Apply on Firewalls</p>
        <p>Apply on firewalls applies your <MadCap:variable name="local-orca.Product_S" /> security policy to any firewalls you have integrated previously with <MadCap:variable name="local-orca.Product_S" /> (see <a href="Firewalls.htm">Firewalls</a>). Currently, <MadCap:variable name="local-orca.SC" /> and Microsoft Azure are the only supported applications and Microsoft Azure only works for egress rules. </p>
        <p>After the apply on firewalls process is initiated, the tickets created can be seen on the <a href="FirewallTickets.htm">Firewall Tickets Screen</a>, together with their status. </p>
        <ol>
            <li>
                <p>Click on <span class="ScreenObject">Actions</span>  to display the <span class="ScreenObject">Actions Menu</span>.</p>
                <p>
                    <img src="../_Orca-Images/MenuSecurityPolicyActions.png" />
                </p>
                <p><MadCap:variable name="local-orca.Product_S" /> recognizes whether the integration is set up. If there is no integration, the <span class="MenuItem">Apply on Firewalls</span> option in the menu will be greyed out and unclickable, and it will show as <span class="MenuItem">Apply on Firewalls (Disabled)</span>. </p>
            </li>
            <li>
                <p>Click on <span class="ScreenObject">Apply on Firewalls</span> from the menu. This will initiate the process and change the option in the <span class="ScreenObject">Actions Menu</span> to be greyed out and show as <span class="MenuItem">Apply on Firewalls (in-progress)</span>. This status will remain until all requests (tickets) have been resolved and implemented or deleted in the network policy change management system. You cannot initiate the process again while there are requests still in progress.  A separate request (ticket) will be submitted for each namespace in your current filter (see <a href="../__SecureCloud/Navigation.htm#Filter">Filter by Namespace</a>). Requests that have been submitted cannot be deleted within <MadCap:variable name="local-orca.Product_S" />. </p>
            </li>
        </ol>
        <MadCap:snippetBlock src="../Resources/TopicTemplates/Collateral/H2_GetHere.flsnp" />
        <MadCap:snippetBlock src="../Resources/Snippets/GetHere_AllowedConnections.flsnp" />
    </body>
</html>