# Policy generated by Tufin Orca
# Domain: generic-bank
# Project: retail
# 
# Notes:
#
# 1. To apply the policies run:
# kubectl apply -f generic-bank-retail.yaml
#
# 2. Namespaces should have unique labels
# The auto-generated policies rely on namespace labels to allow inter-namespace access.
# Run the following command to add labels to all namespaces:                                    
# for ns in $(kubectl get namespaces --output=jsonpath={.items..metadata.name}); do kubectl label namespace $ns namespace=$ns --overwrite; done
#
# 3. Egress access to domain names (FQDN)
# Kubernetes network policies don't support domain names like www.aws.com
# Instead, auto-generated policies contain the IP addresses that were monitored in rules with domain names.
# Domains that are not associated with IP addresses, for example when using wildcards (e.g., *.aws.com), are represented as 0.0.0.0/0.
#
# 4. To delete Tufin Orca policies run:
# for ns in $(kubectl get namespaces --output=jsonpath={.items..metadata.name}); do kubectl delete netpol -l tufin-owner=tufin-orca -l tufin-mode=auto-generated --namespace=$ns; done
#
# 5. To delete ALL network policies run:
# for ns in $(kubectl get namespaces --output=jsonpath={.items..metadata.name}); do kubectl delete netpol --all --namespace=$ns; done
#
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: kube-system.kube-dns
    namespace: kube-system
spec:
    egress:
      - to:
          - ipBlock:
                cidr: 66.102.1.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.71.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 173.194.76.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 64.233.166.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 64.233.167.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 64.233.184.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 108.177.15.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.133.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.140.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.206.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - namespaceSelector:
                matchLabels:
                    name: tufin-system
            podSelector:
                matchLabels:
                    app: kite
      - to:
          - ipBlock:
                cidr: 169.254.169.254/32 # metadata.google.internal
    ingress:
      - from:
          - podSelector:
                matchLabels:
                    k8s-app: heapster
      - from:
          - namespaceSelector:
                matchLabels:
                    namespace: default
            podSelector:
                matchLabels:
                    app: indexer
      - from:
          - namespaceSelector:
                matchLabels:
                    name: tufin-system
            podSelector:
                matchLabels:
                    app: kite
      - from:
          - namespaceSelector:
                matchLabels:
                    namespace: default
            podSelector:
                matchLabels:
                    app: time
      - from:
          - namespaceSelector: {}
      - from:
          - namespaceSelector:
                matchLabels:
                    namespace: default
            podSelector:
                matchLabels:
                    app: admin
      - from:
          - namespaceSelector:
                matchLabels:
                    namespace: default
            podSelector:
                matchLabels:
                    app: customer
    podSelector:
        matchLabels:
            k8s-app: kube-dns
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: default.admin
    namespace: default
spec:
    egress:
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: data
            podSelector:
                matchLabels:
                    app: postgres
      - to:
          - podSelector:
                matchLabels:
                    app: time
      - to:
          - ipBlock:
                cidr: 35.195.180.116/32 # 35.195.180.116
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    ingress:
      - from:
          - ipBlock:
                cidr: 0.0.0.0/0 # ingress
    podSelector:
        matchLabels:
            app: admin
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: default.customer
    namespace: default
spec:
    egress:
      - to:
          - podSelector:
                matchLabels:
                    app: redis
      - to:
          - podSelector:
                matchLabels:
                    app: balance
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    ingress:
      - from:
          - ipBlock:
                cidr: 0.0.0.0/0 # ingress
    podSelector:
        matchLabels:
            app: customer
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: kube-system.default-http-backend
    namespace: kube-system
spec:
    ingress:
      - from:
          - ipBlock:
                cidr: 0.0.0.0/0 # ingress
    podSelector:
        matchLabels:
            k8s-app: glbc
    policyTypes:
      - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: tufin-system.kite
    namespace: tufin-system
spec:
    egress:
      - to:
          - ipBlock:
                cidr: 34.197.189.129/32 # registry-1.docker.io
      - to:
          - ipBlock:
                cidr: 34.199.40.84/32 # registry-1.docker.io
      - to:
          - ipBlock:
                cidr: 34.199.77.19/32 # registry-1.docker.io
      - to:
          - ipBlock:
                cidr: 34.201.196.144/32 # registry-1.docker.io
      - to:
          - ipBlock:
                cidr: 35.195.180.116/32 # 35.195.180.116
      - to:
          - ipBlock:
                cidr: 54.175.43.85/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 3.221.133.86/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 3.224.11.4/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 34.199.40.84/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 34.199.77.19/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 34.201.196.144/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 34.228.211.243/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 34.232.31.24/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 34.192.182.239/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 52.87.94.70/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 54.88.231.116/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 34.197.189.129/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 54.210.105.17/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 100.24.246.89/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 54.165.149.19/32 # auth.docker.io
      - to:
          - ipBlock:
                cidr: 35.195.127.87/32 # guru.tufin.io
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
      - to:
          - ipBlock:
                cidr: 169.254.169.254/32 # metadata.google.internal
      - to:
          - ipBlock:
                cidr: 104.18.124.25/32 # production.cloudflare.docker.com
      - to:
          - ipBlock:
                cidr: 104.18.125.25/32 # production.cloudflare.docker.com
      - to:
          - ipBlock:
                cidr: 104.18.121.25/32 # production.cloudflare.docker.com
      - to:
          - ipBlock:
                cidr: 104.18.122.25/32 # production.cloudflare.docker.com
      - to:
          - ipBlock:
                cidr: 104.18.123.25/32 # production.cloudflare.docker.com
    ingress:
      - from:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    podSelector:
        matchLabels:
            app: kite
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: data.postgres
    namespace: data
spec:
    ingress:
      - from:
          - namespaceSelector:
                matchLabels:
                    namespace: default
            podSelector:
                matchLabels:
                    app: admin
      - from:
          - namespaceSelector:
                matchLabels:
                    namespace: default
            podSelector:
                matchLabels:
                    app: indexer
    podSelector:
        matchLabels:
            app: postgres
    policyTypes:
      - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: default.redis
    namespace: default
spec:
    egress:
      - to:
          - podSelector:
                matchLabels:
                    app: indexer
    ingress:
      - from:
          - podSelector:
                matchLabels:
                    app: customer
      - from:
          - podSelector:
                matchLabels:
                    app: indexer
    podSelector:
        matchLabels:
            app: redis
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: default.indexer
    namespace: default
spec:
    egress:
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: data
            podSelector:
                matchLabels:
                    app: postgres
      - to:
          - podSelector:
                matchLabels:
                    app: redis
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    ingress:
      - from:
          - podSelector:
                matchLabels:
                    app: redis
    podSelector:
        matchLabels:
            app: indexer
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: default.time
    namespace: default
spec:
    egress:
      - to:
          - ipBlock:
                cidr: 192.210.214.132/32 # api.timezonedb.com
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    ingress:
      - from:
          - podSelector:
                matchLabels:
                    app: admin
    podSelector:
        matchLabels:
            app: time
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: default.balance
    namespace: default
spec:
    ingress:
      - from:
          - podSelector:
                matchLabels:
                    app: customer
    podSelector:
        matchLabels:
            app: balance
    policyTypes:
      - Ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: kube-system.heapster
    namespace: kube-system
spec:
    egress:
      - to:
          - ipBlock:
                cidr: 169.254.169.254/32 # metadata.google.internal
      - to:
          - ipBlock:
                cidr: 0.0.0.0/0 # monitoring.googleapis.com
      - to:
          - ipBlock:
                cidr: 64.233.184.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 66.102.1.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.206.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.71.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 173.194.76.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 64.233.166.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.133.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 74.125.140.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 108.177.15.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - ipBlock:
                cidr: 64.233.167.95/32 # cloudimageupdate-pa.googleapis.com
      - to:
          - podSelector:
                matchLabels:
                    k8s-app: kube-dns
    podSelector:
        matchLabels:
            k8s-app: heapster
    policyTypes:
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: data
    namespace: data
spec:
    egress:
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    podSelector: {}
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: default
    namespace: default
spec:
    egress:
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    podSelector: {}
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: kube-public
    namespace: kube-public
spec:
    egress:
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    podSelector: {}
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: kube-system
    namespace: kube-system
spec:
    egress:
      - to:
          - ipBlock:
                cidr: 0.0.0.0/0 # cloudimageupdate-pa.googleapis.com
      - to:
          - podSelector:
                matchLabels:
                    k8s-app: kube-dns
    podSelector: {}
    policyTypes:
      - Ingress
      - Egress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    creationTimestamp: "2019-08-28T15:18:19Z"
    labels:
        tufin-mode: auto-generated
        tufin-owner: tufin-orca
    name: tufin-system
    namespace: tufin-system
spec:
    egress:
      - to:
          - namespaceSelector:
                matchLabels:
                    namespace: kube-system
            podSelector:
                matchLabels:
                    k8s-app: kube-dns
    podSelector: {}
    policyTypes:
      - Ingress
      - Egress